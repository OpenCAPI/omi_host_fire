all: fire.pdf

VERSION := $(shell git rev-parse --short HEAD)
VERSIONMOD := $(shell if ! git diff-index --quiet --relative HEAD; then echo "-dirty"; fi)

gitversion:
	@echo "\newcommand{\gitversion}{$(VERSION)$(VERSIONMOD)}" > version.tex

# Run twice to avoid some weirdness with hyperlinks. There are ways to
# fix it .... eventually ....
fire.pdf: gitversion fire.tex *.tex images/*
	pdflatex -interaction=nonstopmode fire
	pdflatex -interaction=nonstopmode fire

clean:
	rm -f fire.pdf

clean-all:
	rm -f fire.lof fire.lot fire.pdf fire.toc fire.log fire.out *.aux
	rm -f fire-diff* fire-oldtmp*.tex # Files generated by latexdiff
